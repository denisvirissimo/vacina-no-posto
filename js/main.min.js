var ddlEstado,ddlMunicipio,ddlUnidade,listUF=[],listMunicipio=[],listUnidade=[],dicionarioVacinas={};const fetchData=async()=>{return(await fetch("/.netlify/functions/search",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({codigoUBS:ddlUnidade.getValue(!0)})})).json()},initJson=async()=>{let[]=await Promise.all([fetch("/data/unidade.json").then(e=>e.json()).then(e=>listUnidade=e),fetch("/data/municipio.json").then(e=>e.json()).then(e=>listMunicipio=e),fetch("/data/vacina.json").then(e=>e.json()).then(e=>e.vacinas.forEach(e=>dicionarioVacinas[e.chave]=e.valor))])},agruparVacinas=e=>{var n=e.hits.hits.reduce(function(e,n){return e[dicionarioVacinas[n.fields.vacina_fabricante_nome]]=++e[dicionarioVacinas[n.fields.vacina_fabricante_nome]]||1,e},{});return Object.keys(n).map(function(e){return{key:e,value:n[e]}})},exibirAplicacoes=e=>{var n=document.querySelector("#vacinas");n.querySelectorAll("*").forEach(e=>e.remove()),n.className="row g-4 ".concat("row-cols-"+e.length).concat(" row-cols-md-"+e.length),e.forEach(e=>{const t=document.createElement("div");t.className="col";const o=document.createElement("div");o.className="card text-center h-100";const a=document.createElement("div");a.className="card-header",a.appendChild(document.createTextNode(e.key)),o.appendChild(a);const i=document.createElement("div");i.className="card-body";const d=document.createElement("img");d.src="img/".concat(e.key.concat(".png")),d.width="80",i.appendChild(d),o.appendChild(i);const c=document.createElement("div");c.className="card-footer",c.appendChild(document.createTextNode(e.value+" dose(s)")),o.appendChild(c),t.appendChild(o),n.appendChild(t)})},changeDropdown=(e,n,t,o)=>{reinicializarDropdown(e),e.setChoices(n,t,o,!1),e.enable(),e.showDropdown(!1)},reinicializarDropdown=e=>{var n=[];n.push(e.config.choices.find(e=>e.placeholder)),e.setChoices(n,"value","label",!0).setChoiceByValue("")};document.querySelector("#submit").addEventListener("click",function(e){if(!e.target.matches(".btn"))return;if(e.preventDefault(),""===ddlUnidade.getValue(!0))return void document.getElementById("validation").classList.remove("d-none");document.getElementById("error").classList.add("d-none");let n=document.getElementById("submit");n.disabled=!0,n.childNodes[0].className="spinner-border spinner-border-sm",n.childNodes[1].textContent=" Pesquisando...",fetchData().then(e=>{0==e.hits.total.value?(document.getElementById("noResult").classList.remove("d-none"),document.querySelector("#vacinas").querySelectorAll("*").forEach(e=>e.remove())):(document.getElementById("noResult").classList.add("d-none"),exibirAplicacoes(agruparVacinas(e)));document.querySelector("#vacinas").scrollIntoView()}).catch(function(){document.getElementById("error").classList.remove("d-none"),document.querySelector("#vacinas").scrollIntoView()}).finally(function(){n.disabled=!1,n.childNodes[0].className="",n.childNodes[1].textContent="Pesquisar"})},!1),document.addEventListener("DOMContentLoaded",function(){initJson(),ddlEstado=new Choices("#estado",{placeholder:!0,searchPlaceholderValue:"Pesquisar estado",searchResultLimit:2,loadingText:"Carregando...",noResultsText:"Nenhum estado encontrado",noChoicesText:"Nenhuma opção disponível",itemSelectText:"Selecionar"}),ddlMunicipio=new Choices("#municipio",{placeholder:!0,searchPlaceholderValue:"Pesquisar município",searchResultLimit:3,loadingText:"Carregando...",noResultsText:"Nenhum município encontrado",noChoicesText:"Nenhuma opção disponível",itemSelectText:"Selecionar"}),ddlUnidade=new Choices("#unidade",{placeholder:!0,searchPlaceholderValue:"Pesquisar unidade",searchResultLimit:5,loadingText:"Carregando...",noResultsText:"Nenhuma unidade encontrado",noChoicesText:"Nenhuma opção disponível",itemSelectText:"Selecionar"}),ddlMunicipio.disable(),ddlUnidade.disable(),ddlEstado.setChoices(function(){return fetch("/data/uf.json").then(function(e){return e.json()}).then(function(e){return e.ufs})},"Codigo","Nome",!1),ddlEstado.passedElement.element.addEventListener("change",function(e){const n=listMunicipio.municipios.filter(function(n){return n.CodigoUF===Number(e.detail.value)});changeDropdown(ddlMunicipio,n,"Codigo","Nome"),reinicializarDropdown(ddlUnidade),ddlUnidade.disable()}),ddlMunicipio.passedElement.element.addEventListener("change",function(e){const n=listUnidade.unidades.filter(function(n){return n.CodigoMunicipio===Number(e.target.value)});changeDropdown(ddlUnidade,n,"CodigoCNES","Nome")}),ddlUnidade.passedElement.element.addEventListener("change",function(){document.getElementById("validation").classList.add("d-none")}),ddlUnidade.passedElement.element.addEventListener("showDropdown",function(){var e=this.value,n=this.parentElement.parentElement.querySelector('.choices__list--dropdown [data-value="'+e+'"]');n&&(n.classList.add("is-active"),n.parentElement.scrollTop=n.offsetTop-n.parentElement.offsetTop)},!1)});